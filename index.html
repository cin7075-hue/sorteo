<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SORTEO O DONACIÃ“N A CAMPAÃ‘A DE FARITH CASTRO AL SENADO</title>

<style>
body{font-family:Arial;margin:0;background:#f5f7fa}
header{padding:15px;background:#f57c00;color:#fff;text-align:center}
.controls{padding:10px;background:#fff;position:sticky;top:0;z-index:2}
input{padding:6px;margin:3px}
button{padding:6px 10px;margin:3px;border:none;border-radius:6px;cursor:pointer}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(50px,1fr));gap:5px;padding:10px}
.cell{padding:10px 0;text-align:center;border-radius:8px;font-weight:bold;cursor:pointer;transition:.2s}
.available{background:#fff;border:1px solid #ccc}
.reserved{background:#ffd54f}
.sold{background:#ef5350;color:#fff}
.stats{font-size:14px;margin-top:5px}
</style>
</head>

<body>

<header>
<h2>ğŸŸï¸ SORTEO O DONACIÃ“N A CAMPAÃ‘A DE FARITH CASTRO AL SENADO</h2>
</header>

<div class="controls">
<input type="text" id="nombre" placeholder="Tu nombre">
<input type="text" id="telefono" placeholder="Tu telÃ©fono">
<button onclick="guardarReserva()">Guardar reserva</button>

<button onclick="activarAdmin()">ğŸ”’ Admin</button>
<span id="adminPanel" style="display:none;">
<button onclick="marcar('sold')">âœ… Vendido</button>
<button onclick="marcar('available')">â™» Liberar</button>
</span>

<button onclick="descargarLista()">ğŸ“‹ Descargar compradores</button>

<br>
<input type="text" id="buscarNombre" placeholder="Buscar por nombre">
<button onclick="buscar()">ğŸ”</button>

<div class="stats">
Disponibles: <span id="avail">0</span> |
Reservados: <span id="res">0</span> |
Vendidos: <span id="sold">0</span> |
ğŸ’° Recaudado: $<span id="total">0</span> COP
</div>
</div>

<div class="grid" id="grid"></div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
apiKey: "AIzaSyDwmYt51VgHXOnleHm402ggVdRyXU5xBHI",
authDomain: "sorteo-farith.firebaseapp.com",
databaseURL: "https://sorteo-farith-default-rtdb.firebaseio.com",
projectId: "sorteo-farith"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let seleccionado=null;
let isAdmin=false;

function activarAdmin(){
let pass=prompt("Clave admin:");
if(pass==="Changel2020"){
isAdmin=true;
document.getElementById("adminPanel").style.display="inline";
alert("Modo administrador activado");
}else{
alert("Clave incorrecta");
}
}

const grid=document.getElementById("grid");

for(let i=0;i<1000;i++){
let num=i.toString().padStart(3,"0");
let cell=document.createElement("div");
cell.className="cell available";
cell.textContent=num;
cell.dataset.num=num;
cell.onclick=()=>seleccionar(cell);
grid.appendChild(cell);
}

function seleccionar(cell){
document.querySelectorAll(".cell").forEach(c=>c.style.outline="none");
cell.style.outline="3px solid #000";
seleccionado=cell.dataset.num;
}

function guardarReserva(){
if(!seleccionado) return alert("Selecciona un nÃºmero");
let nombre=document.getElementById("nombre").value;
let telefono=document.getElementById("telefono").value;
if(!nombre||!telefono) return alert("Faltan datos");

db.ref("rifa/"+seleccionado).set({
nombre,telefono,state:"reserved"
});
alert("Reserva enviada");
}

function marcar(estado){
if(!isAdmin) return;
if(!seleccionado) return alert("Selecciona un nÃºmero");
db.ref("rifa/"+seleccionado+"/state").set(estado);
}

db.ref("rifa").on("value",snap=>{
let data=snap.val()||{};
let a=0,r=0,s=0,total=0;

document.querySelectorAll(".cell").forEach(c=>{
let n=c.dataset.num;
let info=data[n]||{state:"available"};
c.className="cell "+info.state;

if(info.state==="available") a++;
if(info.state==="reserved") r++;
if(info.state==="sold"){s++;total+=10000;}
});

avail.textContent=a;
res.textContent=r;
sold.textContent=s;
total.textContent=total.toLocaleString();
});

function descargarLista(){
if(!isAdmin) return alert("Solo admin");
db.ref("rifa").once("value",snap=>{
let d=snap.val()||{};
let csv="Numero,Nombre,Telefono,Estado\n";
for(let n in d){
csv+=`${n},${d[n].nombre||""},${d[n].telefono||""},${d[n].state}\n`;
}
let blob=new Blob([csv],{type:"text/csv"});
let a=document.createElement("a");
a.href=URL.createObjectURL(blob);
a.download="compradores.csv";
a.click();
});
}

function buscar(){
let nombre=document.getElementById("buscarNombre").value.toLowerCase();
db.ref("rifa").once("value",snap=>{
let d=snap.val()||{};
let res="";
for(let n in d){
if(d[n].nombre && d[n].nombre.toLowerCase().includes(nombre)){
res+=`${n} - ${d[n].nombre} - ${d[n].telefono}\n`;
}
}
alert(res||"No encontrado");
});
}
</script>

</body>
</html>





